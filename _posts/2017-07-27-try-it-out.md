---
layout: post
current: post
cover:  assets/images/icon.png
navigation: True
title: Try Out Th!nk
date: 2018-01-10 22:17:48
tags: [Getting started]
class: post-template
author: cade
---


<script src="https://www.gstatic.com/firebasejs/4.8.2/firebase.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


<script>

var config = {
    apiKey: "AIzaSyBqTpWrqnXMAudyAWIQsA4tlyuoAvMYfHU",
    authDomain: "think-12e6f.firebaseapp.com",
    databaseURL: "https://think-12e6f.firebaseio.com",
    projectId: "think-12e6f",
    storageBucket: "think-12e6f.appspot.com",
    messagingSenderId: "17821661067"
};

firebase.initializeApp(config);

var database = firebase.database();
var connected_ref = database.ref("connected_users/");

var my_ref = connected_ref.push();


google.charts.load('current', {packages: ['corechart']});
google.charts.setOnLoadCallback(init_chart);

var chart_isinit = false;


var connected_chart = {};

var connected_data = {};

var connected_options = {
    hAxis: {
        title: 'Time',
        viewWindow: {
            min: new Date(),
            max: new Date()
        }
    },
    vAxis: {
        title: 'Th!nk Users Connected'
    },
   // curveType: 'function'
};

function init_chart() {
    chart_isinit = true;

    connected_chart = new google.visualization.LineChart(document.getElementById('think_connected'));

    connected_data = new google.visualization.DataTable();
    connected_data.addColumn('date', 't');
    connected_data.addColumn('number', 'Users Connected');

    setInterval(update_connected, 1000 * .25);

}

function update_connected() {

    connected_ref.once('value').then(function (val) {
        var cdate = new Date();
        var ct = 0;
        for (key in val.val()) {
            person = val.val()[key];
            if (Math.abs(cdate.getTime() - person.timestamp) <= 8 * 1000) {
                ct += 1;
            }
        }
        console.log(ct);
        my_ref.child("timestamp").set(cdate.getTime());

        //connected_data.addRows([[cdate, Math.floor(10 + Math.random() * 20)]]);
        connected_data.addRows([[cdate, ct]]);

        connected_options.hAxis.viewWindow.max = cdate;
        var diff_minutes = 1;
        connected_options.hAxis.viewWindow.min = new Date(cdate.getTime() - diff_minutes*60000);

        connected_chart.draw(connected_data, connected_options);
    });
}

</script>


<div id="think_connected" style="width: 100%; height: 30em;"></div>

