---
layout: post
current: post
navigation: True
title: Try Out Th!nk
date: 2018-01-10 22:17:48
tags: [Getting started]
class: post-template
author: cade
---

{% include think_jslib.html %}


<h2>Right now, you are helping to solve the world's greatest problems! Just by having this page open!</h2>


<script>

var database = firebase.database();
var connected_ref = database.ref("connected_users/");

var my_ref = connected_ref.push();

google.charts.setOnLoadCallback(init_chart);

var chart_isinit = false;

var workload_size = 1000;


var connected_chart = {};

var connected_data = {};

var connected_options = {
    hAxis: {
        title: 'Time',
        viewWindow: {
            min: new Date(),
            max: new Date()
        },
    },
    vAxis: {
        title: 'Th!nk Users Connected',
        viewWindow: {
            min: 0
        }
    },
   // curveType: 'function'
};

function init_chart() {
    chart_isinit = true;

    connected_chart = new google.visualization.LineChart(document.getElementById('think_connected'));

    connected_data = new google.visualization.DataTable();
    connected_data.addColumn('date', 't');
    connected_data.addColumn('number', 'Users Connected');

    setInterval(update_connected, 1000 * .25);

}

function update_connected() {
    connected_ref.once('value').then(function (val) {
        var cdate = new Date();
        var ct = 0;
        for (key in val.val()) {
            person = val.val()[key];
            if (Math.abs(cdate.getTime() - person.timestamp) <= 2.5 * 1000) {
                ct += 1;
            } else {
                connected_ref.child(key).remove();
            }
        }
        my_ref.child("timestamp").set(cdate.getTime());

        //connected_data.addRows([[cdate, Math.floor(10 + Math.random() * 20)]]);
        connected_data.addRows([[cdate, ct]]);

        connected_options.hAxis.viewWindow.max = cdate;
        var diff_minutes = 1;
        connected_options.hAxis.viewWindow.min = new Date(cdate.getTime() - diff_minutes*60000);

        connected_chart.draw(connected_data, connected_options);
    });
}

function workload(recurse) {
    database.ref('primes').once('value').then(function (val) {
        var prime = 0;
        for (key in val.val()) {
            if (parseInt(key) >= prime) {
                prime = parseInt(key) + workload_size;
            }
        }

        console.log("working on block [" + prime + ", " + (prime + workload_size - 1) + "]");

        database.ref('primes/').child(prime).set(["to come"]);

        var res = [];

        for (var i = prime; i < prime + workload_size; i++) {
            res.push(is_prime(i));
        }

        database.ref('primes/').child(prime).set(res);

        if (recurse) setTimeout(function() {workload(true)}, 1000);
    });
}


function is_prime(x) {
    var y;
    if (x < 2) return false;
    if (x == 2) return true;
    if (x % 2 == 0) return false;
    for (y = 3; y * y <= x; y += 2) {
        if (x % y == 0) {
            return false;
        }
    }
    return true;
}



</script>


<div id="think_connected" style="width: 36em; height: 18em; float: right;"></div>




